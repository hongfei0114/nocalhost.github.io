"use strict";(self.webpackChunknh_docs=self.webpackChunknh_docs||[]).push([[1096],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return u}});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(t),u=o,k=m["".concat(s,".").concat(u)]||m[u]||d[u]||r;return t?a.createElement(k,i(i({ref:n},p),{},{components:t})):a.createElement(k,i({ref:n},p))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5886:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return v}});var a=t(2122),o=t(9756),r=(t(7294),t(3905)),i=["components"],l={},s="Config services",c={unversionedId:"config/config-services",id:"config/config-services",isDocsHomePage:!1,title:"Config services",description:"services gives you the options to configure the Kubernetes workloads for better deployment and development experiences. You can configure single or multiple workloads in a single configuration which depends on your application design.",source:"@site/docs/config/config-services.md",sourceDirName:"config",slug:"/config/config-services",permalink:"/docs/config/config-services",editUrl:"https://github.com/nocalhost/nocalhost.github.io/tree/main/docs/config/config-services.md",tags:[],version:"current",lastUpdatedBy:"Garry",lastUpdatedAt:1630036750,formattedLastUpdatedAt:"8/27/2021",frontMatter:{}},p=[{value:"How does it work?",id:"how-does-it-work",children:[]},{value:"Workload Selection",id:"workload-selection",children:[{value:"<code>services[*].name</code>",id:"servicesname",children:[]},{value:"<code>services[*].serviceType</code>",id:"servicesservicetype",children:[]}]},{value:"<code>services[*].dependLabelSelector</code>",id:"servicesdependlabelselector",children:[]},{value:"<code>services[*].containers</code>",id:"servicescontainers",children:[{value:"<code>containers[*].name</code>",id:"containersname",children:[]},{value:"<code>containers[*].install</code>",id:"containersinstall",children:[]},{value:"<code>containers[*].dev</code>",id:"containersdev",children:[]}]}],d=function(e){return function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",n)}},m=d("Tabs"),u=d("TabItem"),k={toc:p};function v(e){var n=e.components,t=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"config-services"},"Config services"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"services")," gives you the options to configure the Kubernetes workloads for better deployment and development experiences. You can configure single or multiple workloads in a single configuration which depends on your ",(0,r.kt)("a",{parentName:"p",href:"./config-ref#application"},"application")," design. "),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"\napplications:\n    name: K8s-app\n    ...\n    services:\n    - name: deployment-workload\n      serviceType: deployment\n        dependLabelSelector:\n          pods: []\n          jobs:\n            - dep-job\n        containers: ...\n    - name: statefulset-workload\n      serviceType: statefulset\n        dependLabelSelector:\n          pods: []\n          jobs:\n            - dep-job\n        containers: ...\n\n")),(0,r.kt)("h2",{id:"how-does-it-work"},"How does it work?"),(0,r.kt)("p",null,"Each entry you configure under ",(0,r.kt)("inlineCode",{parentName:"p"},"application[*].services")," will tell Nocalhost to search for the corresponding workload and configure it. If Nocalhost finds a workload to configure, it will apply the given configurations."),(0,r.kt)("h2",{id:"workload-selection"},"Workload Selection"),(0,r.kt)("p",null,"The following config options are needed to determine the workload to be configured:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#servicesname"},(0,r.kt)("inlineCode",{parentName:"a"},"name"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#servicesservicetype"},(0,r.kt)("inlineCode",{parentName:"a"},"serviceType")))),(0,r.kt)("h3",{id:"servicesname"},(0,r.kt)("inlineCode",{parentName:"h3"},"services[*].name")),(0,r.kt)("p",null,"Nocalhost uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," as a ",(0,r.kt)("strong",{parentName:"p"},"unique")," identifier to match a corresponding Kubernetes workload. The ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," option expects a string that specifies a workload name to select a target workload. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{2,4}","{2,4}":!0},"services:\n  - name: foo-workload-01\n  ...\n  - name: foo-workload-02\n  ...\n\n")),(0,r.kt)("h3",{id:"servicesservicetype"},(0,r.kt)("inlineCode",{parentName:"h3"},"services[*].serviceType")),(0,r.kt)("p",null,"Kubernetes workload type, Nocalhost currently supports all Kubernetes workloads types. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{3}","{3}":!0},"services:\n    - name: deployment-workload\n        serviceType: deployment\n        ...\n\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/workloads/"},"Read more to learn Kubernetes workload")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"./config-dev-workload"},"Read more to learn how Nocalhost DevMode support different workloads"))),(0,r.kt)("h2",{id:"servicesdependlabelselector"},(0,r.kt)("inlineCode",{parentName:"h2"},"services[*].dependLabelSelector")),(0,r.kt)("p",null,"Nocalhost can control the startup sequence of multiple workloads within an application. This is especially useful if:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Workload is dependent on other workloads or services")),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Required Kubernetes 1.16.0+ ")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This feature depends on Kubernetes ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/"},"admission webhooks"),", so please ensure that the minimum version of the Kubernetes is v1.16.0 or Above, and make sure to enable ",(0,r.kt)("strong",{parentName:"p"},"MutatingAdmissionWebhook")," and ",(0,r.kt)("strong",{parentName:"p"},"ValidatingAdmissionWebhook")," controllers."))),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"required nocalhost-dep")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You need to install  ",(0,r.kt)("inlineCode",{parentName:"p"},"nocalhost-dep")," for this configuration to take effect. Please refer to ",(0,r.kt)("a",{parentName:"p",href:"../server/nh-dep"},"Nocalhost Dep")," for more details."))),(0,r.kt)("h4",{id:"example-setting-up-start-dependencies"},"Example: Setting up start dependencies"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml",metastring:"{4}","{4}":!0},'services:\n  - name: foo-app                   # string    | required | Name of workload\n    serviceType: deployment         # string    | required | The Kubernetes workloads type\n    dependLabelSelector:\n      pods:                         # string[]  | optional | Dependent Pods label selector\n        - A-Pod\n        - B-Pod\n      jobs:                         # string[]  | optional | Dependent Jobs label selector\n        - "name=foo-db"\n\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Explanation:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Nocalhost will continuously monitor the status of the ",(0,r.kt)("inlineCode",{parentName:"li"},"A-Pod"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"B-Pod")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"foo-db")," "),(0,r.kt)("li",{parentName:"ul"},"Once these pods and job become available, Nocalhost will start the deployment ",(0,r.kt)("inlineCode",{parentName:"li"},"foo-app"))),(0,r.kt)("h2",{id:"servicescontainers"},(0,r.kt)("inlineCode",{parentName:"h2"},"services[*].containers")),(0,r.kt)("p",null,"Whether your workload is a single component or several that work together, on Kubernetes you run it inside a set of ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/pods"},"pods"),". In Kubernetes, a ",(0,r.kt)("inlineCode",{parentName:"p"},"Pod")," represents a set of running containers on your cluster. "),(0,r.kt)("p",null,"Nocalhost give you the options to configure these containers before deploying and developing."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"\nservices:\n    - name: foo-workload\n      ...\n      containers:\n        - name: container-0\n            ...\n        - name: container-1\n            ...\n        - name: container-2\n            ...\n\n")),(0,r.kt)("h3",{id:"containersname"},(0,r.kt)("inlineCode",{parentName:"h3"},"containers[*].name")),(0,r.kt)("p",null,"Nocalhost use container ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," as ",(0,r.kt)("strong",{parentName:"p"},"unique")," identifier to determine the container to be configured. You can define more than one container with a workload in ",(0,r.kt)("inlineCode",{parentName:"p"},"services[*].containers"),"."),(0,r.kt)("h4",{id:"example-configure-containers"},"Example: Configure containers"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{6,14}","{6,14}":!0},"services:\n    - name: foo-workload\n      serviceType: deployment\n      ...\n      containers:\n        - name: product\n            install:                # struct  | optional | Installation parameters\n              env: []\n              envFrom:\n                envFile: []\n              portForward:\n                - 39080:9080\n            dev: ...                # struct  | optional | Development parameters\n        - name: supermarket\n            install:\n                env: []\n                envForm: ...\n                protForward:\n                    - 38080:9080\n            dev: ...\n\n")),(0,r.kt)("h3",{id:"containersinstall"},(0,r.kt)("inlineCode",{parentName:"h3"},"containers[*].install")),(0,r.kt)("p",null,"You can configure the installation of the container. Nocalhost supports the following installation configuration for the container. "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#inject-environment-variable-to-containers"},"Inject Environment")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#setting-up-port-forwarding"},"Port-Forwarding"))),(0,r.kt)("h4",{id:"inject-environment-variable-to-containers"},"Inject Environment Variable to Containers"),(0,r.kt)("p",null,"Nocalhost supports injecting the preset environment variables to the container when deploying the workload. You can inject these variables by input the values or import the file."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"nocalhost-dep Needed")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You need to install ",(0,r.kt)("inlineCode",{parentName:"p"},"nocalhost-dep")," for this configuration to take effect. Please refer to ",(0,r.kt)("a",{parentName:"p",href:"../server/nh-dep"},"Nocalhost Dep")," for more details."))),(0,r.kt)("h5",{id:"example-inject-environment-variable"},"Example: Inject environment variable"),(0,r.kt)(m,{defaultValue:"c-value",values:[{label:"Inject By Values",value:"c-value"},{label:"Inject By Files",value:"c-file"}],mdxType:"Tabs"},(0,r.kt)(u,{value:"c-value",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"containers[*].install.env # optional")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'\ncontainers:\n  - name: container-01\n    ...\n    install:\n      env: \n        - name: DEBUG\n          value: ${DEBUG:-true}\n        - name: DOMAIN\n          value: "www.coding.com"\n\n'))),(0,r.kt)(u,{value:"c-file",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"containers[*].install.envFrom # optional")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"\ncontainers:\n  - name: container-01\n    ...\n    install:\n      envFrom: \n        envFile: \n          - path: dev.env\n          - path: dev.env\n\n")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Explanation:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"These variables will be injected into container when deploying"),(0,r.kt)("li",{parentName:"ul"},"These variables will take effect after the deployment occurs")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Duplicate Configs")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If both ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"envFrom")," configure together, Nocalhost will merge the configurations, and the duplicate parts are subject to ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," configs."))),(0,r.kt)("h4",{id:"setting-up-port-forwarding"},"Setting up Port-Forwarding"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"containers[*].install.portForward")),(0,r.kt)("p",null,"Port-forwarding allows you to access your container on ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost:[PORT]")," by forwarding the network traffic from a localhost port to a specified port of a container."),(0,r.kt)("p",null,"When container has deployed, Nocalhost starts port-forwarding as configured in the ",(0,r.kt)("inlineCode",{parentName:"p"},"install.port")," section. "),(0,r.kt)("h5",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"\ncontainers:\n  - name: container-01\n    ...\n    install:\n      portForward: \n        - 9883:3306       # string[]  |  optional  | Ports to be forwarded to local when container has been deployed\n        - 9884:3307\n        \n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Using ",(0,r.kt)("inlineCode",{parentName:"li"},"Local Port : Remote Port")," format"),(0,r.kt)("li",{parentName:"ul"},"Can setup multi port-forward")),(0,r.kt)("h3",{id:"containersdev"},(0,r.kt)("inlineCode",{parentName:"h3"},"containers[*].dev")),(0,r.kt)("p",null,"You can configure the container before entering development. ",(0,r.kt)("a",{parentName:"p",href:"../config/config-dev"},"Learn more about how to configure development mode")))}v.isMDXComponent=!0}}]);