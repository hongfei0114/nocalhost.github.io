"use strict";(self.webpackChunknh_docs=self.webpackChunknh_docs||[]).push([[4757],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,f=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return n?o.createElement(f,a(a({ref:t},u),{},{components:n})):o.createElement(f,a({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var c=2;c<i;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},13919:function(e,t,n){function o(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!o(e)}n.d(t,{b:function(){return o},Z:function(){return r}})},44996:function(e,t,n){n.d(t,{C:function(){return i},Z:function(){return a}});var o=n(52263),r=n(13919);function i(){var e=(0,o.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,i=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,o){var i=void 0===o?{}:o,a=i.forcePrependBaseUrl,s=void 0!==a&&a,l=i.absolute,c=void 0!==l&&l;if(!n)return n;if(n.startsWith("#"))return n;if((0,r.b)(n))return n;if(s)return t+n;var u=n.startsWith(t)?n:t+n.replace(/^\//,"");return c?e+u:u}(i,n,e,t)}}}function a(e,t){return void 0===t&&(t={}),(0,i().withBaseUrl)(e,t)}},58215:function(e,t,n){var o=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return o.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},41395:function(e,t,n){n.d(t,{Z:function(){return u}});var o=n(67294),r=n(80944),i=n(86010),a="tabItem_1uMI",s="tabItemActive_2DSg";var l=37,c=39;var u=function(e){var t=e.lazy,n=e.block,u=e.defaultValue,p=e.values,d=e.groupId,m=e.className,f=(0,r.Z)(),h=f.tabGroupChoices,v=f.setTabGroupChoices,k=(0,o.useState)(u),b=k[0],g=k[1],y=o.Children.toArray(e.children),N=[];if(null!=d){var C=h[d];null!=C&&C!==b&&p.some((function(e){return e.value===C}))&&g(C)}var w=function(e){var t=e.currentTarget,n=N.indexOf(t),o=p[n].value;g(o),null!=d&&(v(d,o),setTimeout((function(){var e,n,o,r,i,a,l,c;(e=t.getBoundingClientRect(),n=e.top,o=e.left,r=e.bottom,i=e.right,a=window,l=a.innerHeight,c=a.innerWidth,n>=0&&i<=c&&r<=l&&o>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(s),setTimeout((function(){return t.classList.remove(s)}),2e3))}),150))},D=function(e){var t,n;switch(e.keyCode){case c:var o=N.indexOf(e.target)+1;n=N[o]||N[0];break;case l:var r=N.indexOf(e.target)-1;n=N[r]||N[N.length-1]}null==(t=n)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},m)},p.map((function(e){var t=e.value,n=e.label;return o.createElement("li",{role:"tab",tabIndex:b===t?0:-1,"aria-selected":b===t,className:(0,i.Z)("tabs__item",a,{"tabs__item--active":b===t}),key:t,ref:function(e){return N.push(e)},onKeyDown:D,onFocus:w,onClick:w},n)}))),t?(0,o.cloneElement)(y.filter((function(e){return e.props.value===b}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},y.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==b})}))))}},79443:function(e,t,n){var o=(0,n(67294).createContext)(void 0);t.Z=o},80944:function(e,t,n){var o=n(67294),r=n(79443);t.Z=function(){var e=(0,o.useContext)(r.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},17765:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c},default:function(){return p}});var o=n(22122),r=n(19756),i=(n(67294),n(3905)),a=(n(41395),n(58215),n(44996),["components"]),s={title:"CustomResources"},l={unversionedId:"guides/develop-service-crd-en",id:"guides/develop-service-crd-en",isDocsHomePage:!1,title:"CustomResources",description:"\u5f00\u53d1 CustomResources",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/guides/develop-service-crd-en.md",sourceDirName:"guides",slug:"/guides/develop-service-crd-en",permalink:"/zh-CN/docs/guides/develop-service-crd-en",editUrl:"https://crowdin.com/project/nocalhost/zh-CN",version:"current",frontMatter:{title:"CustomResources"},sidebar:"docs",previous:{title:"DevMode(Duplicate)",permalink:"/zh-CN/docs/guides/develop-service-dup-en"},next:{title:"VPN proxy",permalink:"/zh-CN/docs/guides/develop-service-vpn"}},c=[{value:"\u5f00\u53d1 CustomResources",id:"\u5f00\u53d1-customresources",children:[{value:"How it works",id:"how-it-works",children:[]},{value:"How to use",id:"how-to-use",children:[]}]}],u={toc:c};function p(e){var t=e.components,n=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"\u5f00\u53d1-customresources"},"\u5f00\u53d1 CustomResources"),(0,i.kt)("p",null,"Nocalhost \u4e0d\u4ec5\u652f\u6301\u5bf9 Deployment/StatefulSet/Job \u7b49\u5185\u7f6e\u8d44\u6e90\u8fdb\u884c\u5f00\u53d1\uff0c\u8fd8\u652f\u6301\u5f00\u53d1 ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources"},"CustomResources"),"\u3002"),(0,i.kt)("h3",{id:"how-it-works"},"How it works"),(0,i.kt)("p",null,"Nocalhost \u5bf9 K8s \u8d44\u6e90\u5bf9\u8c61\u7684\u5f00\u53d1\u672c\u8d28\u4e0a\u662f\u5c06 ","[","K8s Controller","]","(",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/architecture/controller/"},"https://kubernetes.io/docs/concepts/architecture/controller/"),") \u63a7\u5236\u7684 Pod \u7684\u4e1a\u52a1\u5bb9\u5668\u955c\u50cf\u66ff\u6362\u4e3a\u5f00\u53d1\u5bb9\u5668\u955c\u50cf\uff0c\u518d\u5c06\u672c\u5730\u7684\u6e90\u4ee3\u7801\u540c\u6b65\u5230\u5f00\u53d1\u5bb9\u5668\u4e2d\u53bb\u3002 \u5728\u5bf9\u67d0\u79cd\u7279\u5b9a\u7c7b\u578b\u7684\u63a7\u5236\u5668\uff08\u5305\u62ec\u5185\u7f6e\u7c7b\u578b\u548c CustomResources \u7c7b\u578b\uff09\u8fdb\u884c\u5f00\u53d1\u65f6\uff0cNocalhost \u9700\u8981\u77e5\u9053\u4ee5\u4e0b 3 \u4e2a\u4fe1\u606f\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Pod \u6a21\u677f\u5b9a\u4e49\u5728 Controller \u5b9a\u4e49\u4e2d\u7684\u8def\u5f84\u3002 For instance, the template path of the built-in Deployment is ",(0,i.kt)("inlineCode",{parentName:"li"},"/spec/template"),". Nocalhost \u901a\u8fc7\u8be5\u8def\u5f84\u53ef\u4ee5\u83b7\u53d6\u5230 Pod \u6a21\u677f\u5e76\u5bf9\u6a21\u677f\u8fdb\u884c\u4fee\u6539\uff0c\u5c06\u4e1a\u52a1\u5bb9\u5668\u955c\u50cf\u66ff\u6362\u6210\u5f00\u53d1\u5bb9\u5668\u955c\u50cf"),(0,i.kt)("li",{parentName:"ul"},"\u662f\u5728\u539f Controller \u7684 Pod \u6a21\u677f\u5b9a\u4e49\u4e0a\u76f4\u63a5\u4fee\u6539\uff0c\u8fd8\u662f\u4f7f\u7528\u8be5 Pod \u6a21\u677f\u5b9a\u4e49\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Deployment\uff1f \u8fd9\u662f\u56e0\u4e3a\u5e76\u4e0d\u662f\u6240\u6709 Controller \u7684 Pod \u6a21\u677f\u90fd\u662f\u53ef\u4ee5\u4fee\u6539\u7684\uff0c \u5982 Job\uff0c \u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0cNocalhost \u4f7f\u7528\u539f Controller \u7684 Pod \u6a21\u677f\u5b9a\u4e49\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Deployment\uff08\u8be5 Deployment \u5bf9\u7528\u6237\u900f\u660e\uff09\uff0c \u8be5 Deployment \u7684 Pod \u6a21\u677f\u5b9a\u4e49\u7684\u5bb9\u5668\u955c\u50cf\u4f1a\u88ab\u4fee\u6539\u4e3a\u5f00\u53d1\u5bb9\u5668\u955c\u50cf\uff0c \u672c\u5730\u7684\u6e90\u4ee3\u7801\u4e5f\u4f1a\u88ab\u540c\u6b65\u5230\u8be5 Pod \u91cc\u3002"),(0,i.kt)("li",{parentName:"ul"},"How to make sure the cluster's traffic only visit the developing image in DevMode? Controller \u5e38\u5e38\u4f1a\u7ba1\u7406\u591a\u4e2a Pod\uff0c \u5982\u679c\u8fdb\u5165\u5f00\u53d1\u6a21\u5f0f\u4e4b\u540e\u8fd8\u5b58\u5728\u591a\u4e2a Pod \u7684\u8bdd\uff0c\u6211\u4eec\u65e0\u6cd5\u4fdd\u8bc1\u96c6\u7fa4\u7684\u6d41\u91cf\u90fd\u53ea\u8bbf\u95ee\u6b63\u5728\u5f00\u53d1\u4e2d\u7684\u90a3\u4e2a Pod\uff0c Hence, Nocalhost will reduce the Pod replicas into 1 in most situations. In terms of the Custom Resources that need to create new Deployment for developing, Nocalhost will reduce the number of the Pod replicas in the original Controller into 0. Take DaemonSet as an example, Nocalhost will delete DaemonSet's Pods altogether through setting the NodeName of DaemonSet's Pods into a non-existent Node.")),(0,i.kt)("p",null,"Nocalhost define how to develop CustomResources by ",(0,i.kt)("inlineCode",{parentName:"p"},"DevModeAction"),". The three fields of ",(0,i.kt)("inlineCode",{parentName:"p"},"DevModeAction")," offer the above three aspects of information. Users can add ",(0,i.kt)("inlineCode",{parentName:"p"},"DevModeAction")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.nh/nhctl/config")," to empower Nocalhost with the ability of developing specific CustomResources. An example of how to configure ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.nh/nhctl/config")," is shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'crdDevModeActions:\n- crdType: statefulsets.v1beta1.apps.kruise.io\n  devModeAction:\n    podTemplatePath: /spec/template\n    create: false\n    scalePatches:\n    - type: json\n      patch: \'[{"op":"replace","path":"/spec/replicas","value":1}]\'\n')),(0,i.kt)("p",null,"notes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"crdType: The form is ",(0,i.kt)("inlineCode",{parentName:"li"},"resource.version.group"),". The resource/version/group are the resource/version/group of CustomResources respectively, namely GVR in reverse, which is used to specify the corresponding CustomResources type of ",(0,i.kt)("inlineCode",{parentName:"li"},"DevModeAction"),"."),(0,i.kt)("li",{parentName:"ul"},"devModeAction: Used to control the actions to take when specific CustomResources objects enter ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"podTemplatePath: Specify the path of Pod template definition. Nocalhost will modify that template. For example, replace the containers' image with develop image, add sidcar containers, etc."),(0,i.kt)("li",{parentName:"ul"},"create: Specify if a new Deployment is created in order to develop when CustomResources objects enter ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode"),".",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If it's set into ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),", Nocalhost will use the Pod template definition in ",(0,i.kt)("inlineCode",{parentName:"li"},"podTemplatePath")," to create a new Deployment. All of the operations in ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode")," will be done in that Deployment."),(0,i.kt)("li",{parentName:"ul"},"If it's set into ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),", Nocalhost will modify the Pod template definition of the CustomResources object directly. All of the operations done in ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode")," will be applied to the CustomeResources object."))),(0,i.kt)("li",{parentName:"ul"},"scalePatches: It specifies the patch that configure the CustomResources object to reduce the amount of replicas into 1 before entering ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode"),". If the amount of replicas has already been 1 or you don't mean to reduce the amount, then you can ignore this piece of config(refering to ",(0,i.kt)("inlineCode",{parentName:"li"},"How to make sure the cluster's traffic only visit the developing image in DevMod?"),").")))),(0,i.kt)("p",null,"Besides, Nocalhost also has built-in support for several common open-source CustomResources, which includes ",(0,i.kt)("a",{parentName:"p",href:"https://openkruise.io/docs/user-manuals/cloneset/"},"CloneSet")," of ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openkruise/kruise"},"Kruise"),", ",(0,i.kt)("a",{parentName:"p",href:"https://openkruise.io/docs/user-manuals/advancedstatefulset"},"Advanced StatefulSet"),", ",(0,i.kt)("a",{parentName:"p",href:"https://openkruise.io/docs/user-manuals/advanceddaemonset"},"Advanced DaemonSet")," etc. You can use Nocalhost to develop these CustomResources without configuration."),(0,i.kt)("h3",{id:"how-to-use"},"How to use"),(0,i.kt)("p",null,"Find the ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomResources")," tab in Nocalhost IDE plugin. Expand that tab and you will see the ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomResources")," list. ",(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/filess/img0@main/2022/01/12/1641976030414-a509b452-89cf-49de-8495-297d14e89dd2.png",alt:null})),(0,i.kt)("p",null,"Right click the ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomeResources")," that you want to develop. A selection box will pop up. Click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Start DevMode")," to develop: ",(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/filess/img12@main/2022/01/12/1641976139936-e651b371-e734-45d5-9785-04d9fb6bf8e6.png",alt:null})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"The operations of CustomResources objects are in line with built-in resources in Workloads like Deployment/StatefulSet etc.")))}p.isMDXComponent=!0},86010:function(e,t,n){function o(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(r&&(r+=" "),r+=t);return r}n.d(t,{Z:function(){return r}})}}]);